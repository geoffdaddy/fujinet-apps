/**
 * @brief   Weather app for the Commodore 64
 * @author  Thomas Cherryhomes
 * @email   thom dot cherryhomes at gmail dot com
 * @license gpl v. 3
 * @verbose weather icon MOBs and code
 */

#include <c64.h>
#include <string.h>
#include "icons.h"

/**
 * @brief MOB pointer locations[0..7] (VIC-II in default bank 0)
 */
#define SPRPTR ((unsigned char *)0x7F8)

/**
 * @brief MOB data starts here at 0x3C00
 */
#define MOBDATA ((unsigned char *)0x3C00)

/**
 * @brief sprite data for i01 = clear sky
 */
unsigned char i01[63] =
  {
    0x00,0x3c,0x00,
    0x03,0xff,0xc0,
    0x0f,0xff,0xe0,
    0x1f,0xff,0xf0,
    0x3f,0xff,0xfc,
    0x7f,0xff,0xfc,
    0x7f,0xff,0xfe,
    0xff,0xff,0xfe,
    0xff,0xff,0xff,
    0xff,0xff,0xff,
    0xff,0xff,0xff,
    0xff,0xff,0xff,
    0xff,0xff,0xff,
    0xff,0xff,0xfe,
    0x7f,0xff,0xfe,
    0x7f,0xff,0xfc    
  };

/**
 * @brief MOB data for i03 = scattered clouds
 */
unsigned char i03[63] =
  {
    0x00,0x60,0x00,
    0x01,0xf8,0x00,
    0x03,0xf8,0x00,
    0x03,0xfc,0x00,
    0x07,0xfc,0x00,
    0x07,0xfe,0x00,
    0x07,0xfe,0xc0,
    0x07,0xff,0xe0,
    0x07,0xff,0xf0,
    0x3f,0xff,0xf0,
    0x7f,0xff,0xf0,
    0xff,0xff,0xf0,
    0xff,0xff,0xfe,
    0xff,0xff,0xfe,
    0xff,0xff,0xff,
    0xff,0xff,0xff
  };

void icons_init(void)
{
  // Set MOB pointers contiguously starting at 0x3C00
  SPRPTR[0]=0xF0;
  SPRPTR[1]=0xF1;
  SPRPTR[2]=0xF2;
  SPRPTR[3]=0xF3;
  SPRPTR[4]=0xF4;
  SPRPTR[5]=0xF5;
  SPRPTR[6]=0xF6;
  SPRPTR[7]=0xF7;
}

/**
 * @brief assign MOB data at m to MOB index i
 * @param m pointer to MOB data
 * @param i MOB index to change
 */
void icon_mob_set(unsigned char *m, unsigned char i)
{
  unsigned short o = i * 64;
  
  memcpy(&MOBDATA[o],m,63);
}

/**
 * @brief test harness
 */
void main(void)
{
  icons_init();
  icon_mob_set(i01,1);
  icon_mob_set(i03,0);
  VIC.spr_exp_x=VIC.spr_exp_y=0x01;
  VIC.spr0_x=100;
  VIC.spr0_y=100;
  VIC.spr1_x=124;
  VIC.spr1_y=107;
  VIC.spr_ena=0xFF;
  VIC.spr0_color=COLOR_WHITE;
  VIC.spr1_color=COLOR_YELLOW;

  while(1);
}
